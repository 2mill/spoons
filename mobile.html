<html>
	<head>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
		<link rel="stylesheet" href="http://131.118.95.193/thesis/style.css">
		<link href='http://fonts.googleapis.com/css?family=Indie+Flower' rel='stylesheet' type='text/css'>
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	</head>
	<body>
		<div class="container state m1">	
			<div class="row col-centered">
				<h1 class="center-text">Spoons</h1>
				<h5 class="center-text">A game developed by Steven Moon</h5>
				<h5 class="center-text">Frostburg State University</h5>
			</div>
			<div class="row col-centered">
				<div class="col-xs-12 col-md-3"></div>
				
				<div class="form-group has-success has-feedback">
			        <label class="control-label" for="inputSuccess4">Room to join:</label>
			        <input type="text" class="form-control" id="m1_room_name" aria-describedby="inputSuccess4Status">
			        <span class="glyphicon glyphicon-ok form-control-feedback" aria-hidden="true"></span>
			        <span id="inputSuccess4Status" class="sr-only">(success)</span>
			    </div>
				<div class="form-group has-success has-feedback">
			        <label class="control-label" for="inputSuccess5">User Name:</label>
			        <input type="text" class="form-control" id="m1_user_name" aria-describedby="inputSuccess5Status">
			        <span class="glyphicon glyphicon-ok form-control-feedback" aria-hidden="true"></span>
			        <span id="inputSuccess5Status" class="sr-only">(success)</span>
			    </div>

				<button id="m1_join_room" type="button" class="btn btn-primary fill-width make-tall-fifty" aria-label="Left Align">
					Join Room
				  <span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>
				</button>
				
				<div class="col-xs-12 col-md-3"></div>
			</div>
			<p></p>
			<div class="row col-centered">
				<div class="col-xs-12 col-md-3">
					<a id="adv_settings" href="#">Advanced Settings...</a>
					<button id="m1_use_as_desktop" type="button" class="btn btn-warning fill-width make-tall-fifty" aria-label="Left Align">
						Use as Desktop
					  <span class="glyphicon glyphicon-th-large" aria-hidden="true"></span>
					</button>
				</div>
			</div>
		</div> <!-- End State m1 -->

		<div class="container state m2">
			<div class="row col-centered">
				<img src="http://131.118.95.193/thesis/loading.gif" class="img-responsive" alt="Responsive image">
			</div>
			<div class="row col-centered">
				<h3 class="center-text">Waiting for additional players...</h3>
			</div>
			<div class="row col-centered">
				<button id="m2_instructions" type="button" class="btn btn-default fill-width make-tall-fifty" aria-label="Left Align">
						View Instructions
				  <span class="glyphicon glyphicon-list" aria-hidden="true"></span>
				</button>
			</div>
		</div><!-- End State m2 -->

		<div class="container state m3">
			<p></p>
			<div class="row other-centered">
				<canvas id="piechart" class="centerme" width="250" height="250">
				</canvas>
			</div>
			<div class="row col-centered">
				<h3 id="start_feedback" class="center-text">Press Play to start game...</h3>
			</div>
			<div class="row col-centered">
				<div class="col-xs-12 col-md-3"></div>
				<div class="col-xs-12 col-md-6">
					<button id="m3_play_game" type="button" class="btn btn-success fill-width make-tall-fifty" aria-label="Left Align">
							Play Game
					  <span class="glyphicon glyphicon-play" aria-hidden="true"></span>
					</button>
				</div>
				<div class="col-xs-12 col-md-3"></div>
			</div>
			<div class="row col-centered">
				<div class="col-xs-12 col-md-3"></div>
				<div class="col-xs-12 col-md-6">
					<button id="m2_instructions" type="button" class="btn btn-default fill-width make-tall-fifty" aria-label="Left Align">
							View Instructions
					  <span class="glyphicon glyphicon-list" aria-hidden="true"></span>
					</button>
				</div>
				<div class="col-xs-12 col-md-3"></div>
			</div>
		</div><!-- End State m3 -->

		<div class="state m4">
			<div class="m4top">
				<div class="m4tq"></div>
				<div class="m4tq"></div>
				<div class="m4tq"></div>
				<div class="m4tq"></div>
			</div>
			<div class="m4mid"></div>
			<div class="m4bot"></div>
		</div><!-- End State m4 -->
		
		<script src="http://code.jquery.com/jquery-latest.min.js"></script>
		<script src="socket.io/socket.io.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
		<script src="http://131.118.95.193/thesis/piechart.js"></script>
		<script>
		var socket = io('http://131.118.95.193:3000');
		var currRoom='';
		var userName='';
		var tog=true;

		function createPieChart(ia,lab) {
			var temp=[];
			var sum=0;
			var sum2=0;
			var i=0;
			for(i=0;i<ia.length;i++){
				sum+=ia[i];
			}
			for(i=0;i<ia.length;i++){
				if(i==ia.length-1){
					temp[temp.length]=(360-sum2);
				}
				else{
					temp[temp.length]=(Math.floor(360*(ia[i]/sum)));
					sum2+=temp[temp.length-1];
				}
			}
			var pieChart = new PieChart( "piechart", 
				{
					includeLabels: true, 
					data: temp,
					labels: lab,
					colors: [
		            	["#D50000", "#D50000"],//red
		            	["#6CFF01", "#6CFF01"]
		            	//["#03BD03", "#03BD03"],
		            	//["#00E5AD", "#00E5AD"],
		            	//["#0200C3", "#0200C3"],
		            	//["#5F2CBC", "#5F2CBC"],
		            	//["#A619AC", "#A619AC"],
		            	//["#E60491", "#E60491"],
		            	//["#FF9108", "#FF9108"],
		            	//["#FFEE00", "#FFEE00"]
					]
				}
			);
			pieChart.draw();
		}
		</script>


		<script>

		$(document).ready(function(){
			goToState(1);
			$("#m1_use_as_desktop").hide();

			$(document).bind('touchmove', function(e) {
				e.preventDefault();
			});
			$("#adv_settings").click(function(){
				tog=!tog;
				if(tog){
					$("#m1_use_as_desktop").hide();
					$("#adv_settings").html("Advanced Settings...");
				}
				else{
				$("#m1_use_as_desktop").show();
					$("#adv_settings").html("Hide Settings...");
				}
			});

			$("#m1_join_room").click(function(){
				socket.emit('player login',{name:$('#m1_user_name').val(),rname:$('#m1_room_name').val()});
			});

			$("#m3_play_game").click(function(){
				socket.emit('player clicked ready',{un:userName,rm:currRoom});
			});
		});

		function goToState(st){
			$('.state').hide();
			$('.m'+st).show();
		}

		//~~~~~~~~~~~~~~~~~~~~Event Driven Networking~~~~~~~~~~~~~~~~

		socket.on('test1', function (data) {
			console.log("Aw yeah in room:"+data);
			//socket.emit('my other event', { my: 'data' });
		});

		socket.on('first login success',function(roomInfo){
			goToState(2);
			var ia=[1];
			var lab=["No Players Ready", "Ready"];
			createPieChart(ia,lab);
			//currRoom=roomInfo.name;
		});

		socket.on('subsequent login success',function(roomInfo){
			goToState(3);
			var readyToPlay=0;
			for(var i=0;i<roomInfo.players.length;++i){
				if(roomInfo.players[i].readyToPlay){
					readyToPlay++;
				}
			}
			var ia=[roomInfo.players.length-readyToPlay,readyToPlay];
			var lab=["Not ready", "Ready"];
			createPieChart(ia,lab);
			//currRoom=roomInfo.name;
		});

		socket.on('register user',function(info){
			userName=info.name;
			currRoom=info.rname;
			//alert('user: '+userName+' | room: '+currRoom);
		});

		socket.on('indiv player ready',function(){
			$("#start_feedback").html("Waiting for other players to start...");
			$("#m3_play_game").hide();
		});

		socket.on('player ready',function(roomInfo){
			var readyToPlay=0;
			for(var i=0;i<roomInfo.players.length;++i){
				if(roomInfo.players[i].readyToPlay){
					readyToPlay++;
				}
			}
			var ia=[roomInfo.players.length-readyToPlay,readyToPlay];
			var lab=["Not ready", "Ready"];
			createPieChart(ia,lab);
		});

		socket.on('all players ready',function(roomInfo){
			goToState(4);
		});

		</script>

	</body>


</html>